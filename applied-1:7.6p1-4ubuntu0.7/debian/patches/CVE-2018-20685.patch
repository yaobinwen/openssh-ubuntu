Backport of:

From 6010c0303a422a9c5fa8860c061bf7105eb7f8b2 Mon Sep 17 00:00:00 2001
From: "djm@openbsd.org" <djm@openbsd.org>
Date: Fri, 16 Nov 2018 03:03:10 +0000
Subject: [PATCH] upstream: disallow empty incoming filename or ones that refer
 to the

current directory; based on report/patch from Harry Sintonen

OpenBSD-Commit-ID: f27651b30eaee2df49540ab68d030865c04f6de9
---
 scp.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

Index: openssh-7.6p1/scp.c
===================================================================
--- openssh-7.6p1.orig/scp.c	2019-01-31 08:56:55.553635620 -0500
+++ openssh-7.6p1/scp.c	2019-01-31 08:56:55.553635620 -0500
@@ -1073,7 +1073,8 @@ sink(int argc, char **argv)
 			SCREWUP("size out of range");
 		size = (off_t)ull;
 
-		if ((strchr(cp, '/') != NULL) || (strcmp(cp, "..") == 0)) {
+		if (*cp == '\0' || strchr(cp, '/') != NULL ||
+		    strcmp(cp, ".") == 0 || strcmp(cp, "..") == 0) {
 			run_err("error: unexpected filename: %s", cp);
 			exit(1);
 		}
